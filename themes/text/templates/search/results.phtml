<?php
  // Set up page title:
  $lookfor = $this->results->getUrlQuery()->isQuerySuppressed() ? '' : $this->params->getDisplayQuery();
  if (isset($this->overrideTitle)) {
      $this->headTitle($this->overrideTitle);
  } else {
      $this->headTitle($this->translate('Search Results') . (empty($lookfor) ? '' : " - {$lookfor}"));
  }

  // Set up search box:
  $this->layout()->searchbox = $this->context($this)->renderInContext(
      'search/searchbox.phtml',
      [
        'lookfor' => $lookfor,
        'searchIndex' => $this->params->getSearchHandler(),
        'searchType' => $this->params->getSearchType(),
        'searchId' => $this->results->getSearchId(),
        'searchClassId' => $this->params->getSearchClassId(),
        'checkboxFilters' => $this->params->getCheckboxFacets(),
        'filterList' => $this->params->getFilters(),
        'hasDefaultsApplied' => $this->params->hasDefaultsApplied(),
        'selectedShards' => $this->params->getSelectedShards(),
        'ignoreHiddenFiltersInRequest' => isset($this->ignoreHiddenFiltersInRequest) ? $this->ignoreHiddenFiltersInRequest : false,
        'ignoreHiddenFilterMemory' => isset($this->ignoreHiddenFilterMemory) ? $this->ignoreHiddenFilterMemory : false,
      ]
  );
  $recordTotal = $this->results->getResultTotal()
?>

<?php
  /* Pagination */
  ob_start();
  $pages = $this->results->getPaginator()->getPages();
?>
<?php if ($pages->pageCount): ?>
  <p><nav>
    <?php if (isset($pages->previous)): ?>
      <a href="<?=$this->currentPath() . $this->results->getUrlQuery()->setPage($pages->previous)?>">&laquo; <?=$this->transEsc('Prev')?></a>
    <?php endif; ?>

    #<?=$pages->current ?> of <?=$pages->pageCount ?>

    <?php if (isset($pages->next)): ?>
      <a href="<?=$this->currentPath() . $this->results->getUrlQuery()->setPage($pages->next)?>"><?=$this->transEsc('Next');?> &raquo;</a>
    <?php endif; ?>
  </nav></p>
<?php endif; ?>
<?php
  $pagination = ob_get_contents();
  ob_end_clean();
?>

<?php if ($recordTotal < 1): ?>
  <p>
    <?php if (isset($this->overrideEmptyMessage)): ?>
      <?=$this->overrideEmptyMessage?>
    <?php else: ?>
      <?php $this->layout()->srmessage = $this->translate('nohit_lookfor_html', ['%%lookfor%%' => $this->escapeHtml($lookfor)]); ?>
      <?=$this->layout()->srmessage ?>
    <?php endif; ?>
  </p>
<?php else: ?>
  <p><?=$this->context()->renderInContext('search/showing.phtml', ['lookfor' => $lookfor, 'recordTotal' => $recordTotal]) ?></p>
  <?=$pagination ?>
  <?php
    /* Show results */
    if (!isset($this->indexStart)) {
      $this->indexStart = 0;
    }
    $i = $this->indexStart;
  ?>
  <ol start="<?=$this->results->getStartRecord(); ?>">
    <?php foreach ($this->results->getResults() as $current): ?>
      <li>
        <a href="<?=$this->recordLink()->getUrl($current)?>"><?=$current->getTitle(); ?></a>
        <?php if (!empty($years = $current->getPublicationDates())): ?>
          (<?=$years[0] ?>)
        <?php endif; ?>
        <?php if (!empty($author = $current->getPrimaryAuthor())): ?>
          <?=$this->transEsc('by') ?> <?=$author ?>
        <?php endif; ?>
      </li>
    <?php endforeach; ?>
  </ol>
  <?=$pagination ?>
<?php endif; ?>
